import{__decorate as t,__metadata as e}from"tslib";import{LitElement as i,css as s,html as r}from"lit";import{property as a,customElement as o}from"lit/decorators.js";class l{constructor(){this.apiMap={}}require(t,e,i){var s=this.nameFromUrl(t);this.apiMap[s]||(this.apiMap[s]=new n(s,t,i)),this.apiMap[s].requestNotify(e)}static getInstance(){return l.instance||(l.instance=new l),l.instance}nameFromUrl(t){return t.replace(/[\:\/\%\?\&\.\=\-\,]/g,"_")+"_api"}}class n{constructor(t,e,i){if(this.callbackMacro="%%callback%%",this.loaded=!1,this.script=null,this.notifiers=[],!i){if(!(e.indexOf(this.callbackMacro)>=0))return void console.error("ScriptLoader class: a %%callback%% parameter is required in libraryUrl");i=t+"_loaded",e=e.replace(this.callbackMacro,i)}this.callbackName=i,window[this.callbackName]=this.success.bind(this),this.addScript(e)}addScript(t){var e=document.createElement("script");e.src=t,e.onerror=this.handleError.bind(this);var i=document.querySelector("script")||document.body;i.parentNode.insertBefore(e,i),this.script=e}removeScript(){this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.script=null}handleError(t){this.error=new Error("Library failed to load"),this.notifyAll(),this.cleanup()}success(){this.loaded=!0,this.result=Array.prototype.slice.call(arguments),this.notifyAll(),this.cleanup()}cleanup(){delete window[this.callbackName]}notifyAll(){this.notifiers.forEach(function(t){t(this.error,this.result)}.bind(this)),this.notifiers=[]}requestNotify(t){this.loaded||this.error?t(this.error,this.result):this.notifiers.push(t)}}class p extends i{constructor(){super(...arguments),this.libraryLoaded=!1,this.libraryErrorMessage=null,this.isReady=!1}get callbackName(){return null}libraryUrlChanged(){this.isReady&&null!=this.libraryUrl&&this.loadLibrary()}libraryLoadCallback(t,e){t?(console.warn("Library load failed:",t.message),this.libraryErrorMessage=t.message):(this.libraryErrorMessage=null,this.libraryLoaded=!0,null!=this.notifyEvent&&this.dispatchEvent(new CustomEvent(this.notifyEvent,{detail:e,composed:!0})))}loadLibrary(){l.getInstance().require(this.libraryUrl,this.libraryLoadCallback.bind(this),this.callbackName)}connectedCallback(){super.connectedCallback(),this.isReady=!0,null!=this.libraryUrl&&this.loadLibrary()}}let h=class extends p{constructor(){super(...arguments),this.apiKey="",this.clientId="",this.mapsUrl="https://maps.googleapis.com/maps/api/js?callback=%%callback%%",this.version="3.39",this.language="",this.mapId=""}get libraryUrl(){return this.computeUrl(this.mapsUrl,this.version,this.apiKey,this.clientId,this.language,this.mapId)}get notifyEvent(){return"api-load"}computeUrl(t,e,i,s,r,a){var o=t+"&v="+e;if(o+="&libraries=drawing,geometry,places,visualization",i&&!s&&(o+="&key="+i),s&&(o+="&client="+s),!i&&!s){console.warn("No Google Maps API Key or Client ID specified. See https://developers.google.com/maps/documentation/javascript/get-api-key for instructions to get started with a key or client id.")}return r&&(o+="&language="+r),a&&(o+="&map_ids="+a),o}};t([a({type:String,attribute:"api-key"}),e("design:type",Object)],h.prototype,"apiKey",void 0),t([a({type:String,attribute:"client-id"}),e("design:type",Object)],h.prototype,"clientId",void 0),t([a({type:String,attribute:"maps-url"}),e("design:type",Object)],h.prototype,"mapsUrl",void 0),t([a({type:String}),e("design:type",Object)],h.prototype,"version",void 0),t([a({type:String}),e("design:type",Object)],h.prototype,"language",void 0),t([a({type:String,attribute:"map-id"}),e("design:type",Object)],h.prototype,"mapId",void 0),h=t([o("lit-google-maps-api")],h);let c=class extends i{constructor(){super(...arguments),this.latitude=0,this.longitude=0,this.label=null,this.zIndex=0,this.open=!1,this.icon=null,this.map=null,this.marker=null}attributeChangedCallback(t,e,i){var s,r;switch(super.attributeChangedCallback(t,e,i),t){case"open":this.openChanged();break;case"latitude":case"longitude":this.updatePosition();break;case"label":null===(s=this.marker)||void 0===s||s.setLabel(i);break;case"z-index":null===(r=this.marker)||void 0===r||r.setZIndex(i)}}openChanged(){this.info&&(this.open?(this.info.open(this.map,this.marker),this.dispatchEvent(new CustomEvent("google-map-marker-open",{bubbles:!0}))):(this.info.close(),this.dispatchEvent(new CustomEvent("google-map-marker-close",{bubbles:!0}))))}updatePosition(){var t;null===(t=this.marker)||void 0===t||t.setPosition(new google.maps.LatLng(this.latitude,this.longitude))}changeMap(t){this.map=t,this.mapChanged()}mapChanged(){this.marker&&(this.marker.setMap(null),google.maps.event.clearInstanceListeners(this.marker)),this.map&&this.map instanceof google.maps.Map&&this.mapReady()}mapReady(){this.marker=new google.maps.Marker({map:this.map,icon:this.icon,position:{lat:this.latitude,lng:this.longitude},label:this.label,zIndex:this.zIndex}),this.contentChanged()}contentChanged(){this.contentObserver&&this.contentObserver.disconnect(),this.contentObserver=new MutationObserver(this.contentChanged.bind(this)),this.contentObserver.observe(this,{childList:!0,subtree:!0});var t=this.innerHTML.trim();t?(this.info||(this.info=new google.maps.InfoWindow,this.openInfoHandler=google.maps.event.addListener(this.marker,"click",function(){this.open=!0}.bind(this)),this.closeInfoHandler=google.maps.event.addListener(this.info,"closeclick",function(){this.open=!1}.bind(this))),this.info.setContent(t)):this.info&&(google.maps.event.removeListener(this.openInfoHandler),google.maps.event.removeListener(this.closeInfoHandler),this.info=null)}};t([a({type:Number,reflect:!0}),e("design:type",Number)],c.prototype,"latitude",void 0),t([a({type:Number,reflect:!0}),e("design:type",Number)],c.prototype,"longitude",void 0),t([a({type:String,reflect:!0}),e("design:type",String)],c.prototype,"label",void 0),t([a({type:Number,reflect:!0,attribute:"z-index"}),e("design:type",Number)],c.prototype,"zIndex",void 0),t([a({type:Boolean,reflect:!0}),e("design:type",Boolean)],c.prototype,"open",void 0),t([a({type:String,reflect:!0}),e("design:type",String)],c.prototype,"icon",void 0),c=t([o("lit-google-map-marker")],c);let d=class extends i{constructor(){super(...arguments),this.centerLatitude=-34.397,this.centerLongitude=150.644,this.radius=1e5,this.fillColor="#FF0000",this.fillOpacity=.35,this.strokeColor="#FF0000",this.strokeOpacity=.8,this.strokeWeight=2,this.map=null,this.circle=null}attachToMap(t){this.map=t,this.mapChanged()}mapChanged(){this.circle&&(this.circle.setMap(null),google.maps.event.clearInstanceListeners(this.circle)),this.map&&this.map instanceof google.maps.Map&&this.mapReady()}mapReady(){this.circle=new google.maps.Circle({map:this.map,strokeColor:this.strokeColor,strokeOpacity:this.strokeOpacity,strokeWeight:this.strokeWeight,fillColor:this.fillColor,fillOpacity:this.fillOpacity,center:{lat:this.centerLatitude,lng:this.centerLongitude},radius:this.radius})}};t([a({type:Number,attribute:"center-latitude"}),e("design:type",Number)],d.prototype,"centerLatitude",void 0),t([a({type:Number,attribute:"center-longitude"}),e("design:type",Number)],d.prototype,"centerLongitude",void 0),t([a({type:Number}),e("design:type",Number)],d.prototype,"radius",void 0),t([a({type:String,attribute:"fill-color"}),e("design:type",String)],d.prototype,"fillColor",void 0),t([a({type:Number,attribute:"fill-opacity"}),e("design:type",Number)],d.prototype,"fillOpacity",void 0),t([a({type:String,attribute:"stroke-color"}),e("design:type",String)],d.prototype,"strokeColor",void 0),t([a({type:Number,attribute:"stroke-opacity"}),e("design:type",Number)],d.prototype,"strokeOpacity",void 0),t([a({type:Number,attribute:"stroke-weight"}),e("design:type",Number)],d.prototype,"strokeWeight",void 0),d=t([o("lit-google-map-circle")],d);let g=class extends i{constructor(){super(...arguments),this.paths=[],this.fillColor="#FF0000",this.fillOpacity=.35,this.strokeColor="#FF0000",this.strokeOpacity=.8,this.strokeWeight=2,this.map=null,this.polygon=null}attachToMap(t){this.map=t,this.mapChanged()}mapChanged(){this.polygon&&(this.polygon.setMap(null),google.maps.event.clearInstanceListeners(this.polygon)),this.map&&this.map instanceof google.maps.Map&&this.mapReady()}mapReady(){this.polygon=new google.maps.Polygon({map:this.map,strokeColor:this.strokeColor,strokeOpacity:this.strokeOpacity,strokeWeight:this.strokeWeight,fillColor:this.fillColor,fillOpacity:this.fillOpacity,paths:this.paths})}};t([a({type:Array}),e("design:type",Array)],g.prototype,"paths",void 0),t([a({type:String,attribute:"fill-color"}),e("design:type",String)],g.prototype,"fillColor",void 0),t([a({type:Number,attribute:"fill-opacity"}),e("design:type",Number)],g.prototype,"fillOpacity",void 0),t([a({type:String,attribute:"stroke-color"}),e("design:type",String)],g.prototype,"strokeColor",void 0),t([a({type:Number,attribute:"stroke-opacity"}),e("design:type",Number)],g.prototype,"strokeOpacity",void 0),t([a({type:Number,attribute:"stroke-weight"}),e("design:type",Number)],g.prototype,"strokeWeight",void 0),g=t([o("lit-google-map-polygon")],g);let m=class extends i{constructor(){super(...arguments),this.apiKey="",this.version="3.48",this.styles={},this.zoom=8,this.fitToMarkers=!1,this.mapType="roadmap",this.centerLatitude=-34.397,this.centerLongitude=150.644,this.language="",this.mapId="",this.map=null}initGMap(){if(null==this.map){var t=this.shadowRoot.getElementById("api");null!=t&&1==t.libraryLoaded&&(this.map=new google.maps.Map(this.shadowRoot.getElementById("map"),this.getMapOptions()),this.updateMarkers(),this.updateShapes())}}getMapOptions(){return{zoom:this.zoom,center:{lat:this.centerLatitude,lng:this.centerLongitude},mapTypeId:this.mapType,styles:this.styles,mapId:this.mapId}}mapApiLoaded(){this.initGMap()}connectedCallback(){super.connectedCallback(),this.initGMap()}attachChildrenToMap(t){if(this.map)for(let e of t)e.changeMap(this.map)}observeMarkers(){this.marketObserverSet||(this.addEventListener("selector-items-changed",(t=>{this.updateMarkers()})),this.marketObserverSet=!0)}updateMarkers(){this.observeMarkers();var t=this.shadowRoot.getElementById("markers-selector");if(t){var e=t.items;if(this.markers&&e.length===this.markers.length)if(0==e.filter((t=>this.markers&&-1===this.markers.indexOf(t))).length)return;this.markers=e,this.attachChildrenToMap(this.markers),this.fitToMarkers&&this.fitToMarkersChanged()}}updateShapes(){var t=this.shadowRoot.getElementById("shapes-selector");if(t){this.shapes=t.items;for(let t of this.shapes)t.attachToMap(this.map)}}fitToMarkersChanged(){if(this.map&&this.fitToMarkers&&this.markers.length>0){var t=new google.maps.LatLngBounds;for(var e of this.markers)t.extend(new google.maps.LatLng(e.latitude,e.longitude));this.markers.length>1&&this.map.fitBounds(t),this.map.setCenter(t.getCenter())}}deselectMarker(t){}deselectShape(t){}render(){return r`
            <lit-google-maps-api 
                id="api" 
                api-key="${this.apiKey}" 
                version="${this.version}"
                language="${this.language}"
                map-id="${this.mapId}"
                @api-load=${()=>this.mapApiLoaded()}>
            </lit-google-maps-api>
            <lit-selector 
                id="markers-selector"
                selected-attribute="open"
                activate-event="google-map-marker-open"
                @google-map-marker-close=${t=>this.deselectMarker(t)}>
                    <slot id="markers" name="markers"></slot>
            </lit-selector>
            <lit-selector 
                id="shapes-selector"
                selected-attribute="open"
                activate-event="google-map-shape-open"
                @google-map-shape-close=${t=>this.deselectShape(t)}>
                    <slot id="shapes" name="shapes"></slot>
            </lit-selector>
            <div id="map">
            </div>
        `}};m.styles=s`
        #map {
            width: 100%;
            height: 100%;
        }
    `,t([a({type:String,attribute:"api-key"}),e("design:type",String)],m.prototype,"apiKey",void 0),t([a({type:String}),e("design:type",String)],m.prototype,"version",void 0),t([a({type:Object}),e("design:type",Object)],m.prototype,"styles",void 0),t([a({type:Number}),e("design:type",Number)],m.prototype,"zoom",void 0),t([a({type:Boolean,attribute:"fit-to-markers"}),e("design:type",Boolean)],m.prototype,"fitToMarkers",void 0),t([a({type:String,attribute:"map-type"}),e("design:type",String)],m.prototype,"mapType",void 0),t([a({type:Number,attribute:"center-latitude"}),e("design:type",Number)],m.prototype,"centerLatitude",void 0),t([a({type:Number,attribute:"center-longitude"}),e("design:type",Number)],m.prototype,"centerLongitude",void 0),t([a({type:String}),e("design:type",String)],m.prototype,"language",void 0),t([a({type:String,attribute:"map-id"}),e("design:type",String)],m.prototype,"mapId",void 0),m=t([o("lit-google-map")],m);class u{constructor(t){this.multi=!1,this.selection=[],this.selectCallback=t}get(){return this.multi?this.selection.slice():this.selection[0]}clear(t){this.selection.slice().forEach((e=>{(!t||t.indexOf(e)<0)&&this.setItemSelected(e,!1)}))}isSelected(t){return this.selection.indexOf(t)>=0}setItemSelected(t,e){if(null!=t&&e!=this.isSelected(t)){if(e)this.selection.push(t);else{var i=this.selection.indexOf(t);i>=0&&this.selection.splice(i,1)}this.selectCallback&&this.selectCallback(t,e)}}select(t){this.multi?this.toggle(t):this.get()!==t&&(this.setItemSelected(this.get(),!1),this.setItemSelected(t,!0))}toggle(t){this.setItemSelected(t,!this.isSelected(t))}}let y=class extends i{constructor(){super(...arguments),this.activateEvent="tap",this.selectedAttribute=null,this.selected=null,this._selection=new u(((t,e)=>this.applySelection(t,e))),this._items=[]}get items(){return this._items}connectedCallback(){super.connectedCallback(),this.addEventListener("slotchange",(t=>{t.stopPropagation(),this.updateItems(),this.dispatchEvent(new CustomEvent("selector-items-changed",{detail:{},composed:!0}))})),this.addListener(this.activateEvent)}disconnectedCallback(){super.disconnectedCallback(),this.removeListener(this.activateEvent)}attributeChangedCallback(t,e,i){if(super.attributeChangedCallback(t,e,i),"selected"===t)this.updateSelected()}applySelection(t,e){this.selectedAttribute&&t instanceof Element&&e!=t.hasAttribute(this.selectedAttribute)&&t.toggleAttribute(this.selectedAttribute)}updateItems(){var t,e=this.querySelector("slot");this._items=null!==(t=null==e?void 0:e.assignedNodes())&&void 0!==t?t:[]}addListener(t){this.addEventListener(t,(t=>this.activateHandler(t)))}removeListener(t){this.removeEventListener(t,(t=>this.activateHandler(t)))}activateHandler(t){for(var e=t.target,i=this.items;e&&e!=this;){var s=i.indexOf(e);if(s>=0){var r=this.indexToValue(s);return void this.itemActivate(r,e)}e=e.parentNode}}itemActivate(t,e){this.dispatchEvent(new CustomEvent("selector-item-activate",{detail:{selected:t,item:e},composed:!0,cancelable:!0}))&&this.select(t)}select(t){this.selected=t}updateSelected(){this.selectSelected(this.selected)}selectSelected(t){if(this._items){var e=this.valueToItem(this.selected);e?this._selection.select(e):this._selection.clear()}}valueToItem(t){return null==t?null:this._items[this.valueToIndex(t)]}valueToIndex(t){return Number(t)}indexToValue(t){return t}indexOf(t){return this._items?this._items.indexOf(t):-1}};t([a({type:String,attribute:"activate-event"}),e("design:type",String)],y.prototype,"activateEvent",void 0),t([a({type:String,attribute:"selected-attribute"}),e("design:type",String)],y.prototype,"selectedAttribute",void 0),t([a({type:Number,reflect:!0}),e("design:type",Object)],y.prototype,"selected",void 0),y=t([o("lit-selector")],y);export{m as LitGoogleMap,d as LitGoogleMapCircle,c as LitGoogleMapMarker,g as LitGoogleMapPolygon,h as LitGoogleMapsApi,y as LitSelector};
